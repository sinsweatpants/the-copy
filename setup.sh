#!/bin/bash

# Script ูุชุดุบูู ุงููุญูู ุงูุฏุฑุงูู ูุงููุจุฏุน ุงููุญุงูู

echo "๐ญ ุชุดุบูู ุงููุญูู ุงูุฏุฑุงูู ูุงููุจุฏุน ุงููุญุงูู"
echo "========================================"

# ุชุญูู ูู ูุชุทูุจุงุช ุงููุธุงู
if ! command -v node &> /dev/null; then
    echo "โ Node.js ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Node.js 20 ุฃู ุฃุญุฏุซ"
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "โ npm ุบูุฑ ูุซุจุช"
    exit 1
fi

echo "โ ุชุญูู ูู ุงููุชุทูุจุงุช ููุชูู"

# ุชุซุจูุช ุงูุชุจุนูุงุช ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
if [ ! -d "node_modules" ]; then
    echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."
    npm ci
fi

# ุฅูุดุงุก ูููุงุช ุงูุจูุฆุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
if [ ! -f "backend/.env.production" ]; then
    echo "โ๏ธ ุฅูุดุงุก ููู ุงูุจูุฆุฉ ููุฎุงุฏู..."
    cp backend/.env.production.example backend/.env.production
    echo "โ๏ธ  ุชุญุฐูุฑ: ูุฑุฌู ุชุญุฏูุซ ููู backend/.env.production ุจุงูููู ุงูุตุญูุญุฉ"
fi

if [ ! -f "frontend/.env.production" ]; then
    echo "โ๏ธ ุฅูุดุงุก ููู ุงูุจูุฆุฉ ูููุงุฌูุฉ..."
    echo "VITE_API_BASE=http://localhost:4000/api" > frontend/.env.production
fi

# ุจูุงุก ุงููุดุฑูุน
echo "๐จ ุจูุงุก ุงููุดุฑูุน..."
npm run build

if [ $? -eq 0 ]; then
    echo "โ ุงูุจูุงุก ููุชูู ุจูุฌุงุญ"
    
    echo ""
    echo "๐ ุงููุดุฑูุน ุฌุงูุฒ ููุชุดุบูู!"
    echo ""
    echo "ููุชุดุบูู ูู ุจูุฆุฉ ุงูุชุทููุฑ:"
    echo "  npm run dev"
    echo ""
    echo "ููุชุดุบูู ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ:"
    echo "  npm run start:prod"
    echo ""
    echo "๐ ููุงุญุธุงุช ูููุฉ:"
    echo "1. ุชุฃูุฏ ูู ุชุญุฏูุซ backend/.env.production ุจููุชุงุญ Gemini API"
    echo "2. ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช PostgreSQL ุฅุฐุง ููุช ุชุฑูุฏ ุงุณุชุฎุฏุงููุง"
    echo "3. ุงููุดุฑูุน ูุนูู ุจุฏูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุฑุงุถูุงู"
    echo ""
    echo "๐ญ ุงููุญูู ุงูุฏุฑุงูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!"
    
else
    echo "โ ูุดู ูู ุงูุจูุงุก"
    exit 1
fi