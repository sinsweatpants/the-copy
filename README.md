# مشروع the-copy - المحلل الدرامي والمبدع المحاكي

## 🎭 نظرة عامة

مشروع **the-copy** هو بيئة تطوير متكاملة (IDE) مخصصة لكتابة وتحليل السيناريوهات باللغة العربية، مع واجهة حديثة تعتمد على **React + Vite** للـ Frontend، و **Node.js + Express + PostgreSQL** للـ Backend.

المشروع يجمع بين:
- **محرر السيناريو المتقدم**: مع تصحيح تلقائي وتحليل ذكي
- **المحلل الدرامي والمبدع المحاكي**: نظام تحليل متطور يعمل بالذكاء الاصطناعي

## ✨ الميزات الجديدة - المحلل الدرامي

### 🔍 أنواع التحليل المتاحة

#### 1. تحليل النصوص الدرامية
- **التحليل التشخيصي الشامل**: تقرير معمق يغطي البنية، الحوار، والإيقاع
- **تحليل الجدوى التجارية**: تقييم إمكانيات النجاح التجاري والجمهور المستهدف
- **تحليل بصمة الكاتب**: دراسة الأسلوب الفريد للكاتب في الحوار والسرد
- **تحليل الشخصيات المعمق**: ملفات نفسية ودرامية متكاملة للشخصيات
- **التحليل الكمي**: تقييم كمي للنص عبر معايير متعددة

#### 2. الإبداع والمحاكاة
- **إنتاج محتوى إبداعي**: محاكاة أسلوب الكاتب الأصلي
- **استكمال النصوص**: إكمال النصوص الناقصة بذكاء تنبؤي
- **التكامل الذكي**: دمج التحليل مع الإبداع التوليدي

### 🤖 أنماط التفاعل المتعددة

#### 💼 التحليل الفردي
تحليل تقليدي بخبير واحد متخصص مع اختيار نوع التحليل المطلوب

#### 💬 المحادثة التفاعلية
حوار مباشر مع خبراء متخصصين:
- **المحلل الدرامي الرئيسي**: خبير في البنية الدرامية والحبكة
- **خبير الشخصيات**: متخصص في التحليل النفسي للشخصيات
- **محلل السوق (سحر)**: خبيرة في الجدوى التجارية والجمهور
- **محلل بصمة الكاتب**: متخصص في تحليل الأسلوب الأدبي
- **المساعد الإبداعي**: مختص في الكتابة والمحاكاة

#### 🤖 حوار السرب
حوار جماعي بين عدة خبراء للحصول على تحليل شامل ومتعدد الأبعاد

### 📁 معالجة الملفات المتقدمة
- **رفع متعدد الصيغ**: دعم النصوص (.txt, .md)، الصور، وملفات PDF
- **معالجة ذكية**: تحويل المحتوى لصيغة مناسبة لـ Gemini API
- **دعم المحتوى العربي**: واجهة RTL مصممة خصيصاً للمحتوى العربي

### 📊 عرض النتائج المتطور
- **تنسيق Markdown**: عرض منظم وجميل للتحليلات
- **إمكانيات التصدير**: تحميل النتائج كملفات Markdown
- **نسخ سريع**: نسخ أقسام أو التحليل كاملاً
- **إحصائيات مفصلة**: عدد الكلمات، الأحرف، ووقت القراءة المقدر

---

## 🚀 التثبيت والإعداد

## ٢. المتطلبات الأساسية

* **Node.js** ≥ 20
* **npm** ≥ 9
* **PostgreSQL** ≥ 15 (اختياري)
* **Redis** (اختياري)
* **Git**
* **مفتاح Gemini API** للتحليل الذكي
* بيئة تشغيل Linux أو macOS أو Windows

---

## ٣. التثبيت والإعداد السريع

### 🚀 التثبيت التلقائي (موصى به)

```bash
git clone https://github.com/sinsweatpants/the-copy.git
cd the-copy
chmod +x setup.sh
./setup.sh
```

### ⚙️ التثبيت اليدوي

```bash
git clone https://github.com/sinsweatpants/the-copy.git
cd the-copy
npm ci
```

### إعداد متغيرات البيئة

#### backend/.env.production

```
NODE_ENV=production
PORT=4000

# قاعدة البيانات (اختياري)
DATABASE_URL=postgres://user:password@localhost:5432/thecopy
DISABLE_DB=true  # اتركها true إذا كنت لا تريد استخدام قاعدة البيانات

# Redis (اختياري)
REDIS_URL=redis://localhost:6379
DISABLE_REDIS=true

# مفاتيح JWT (مطلوبة)
JWT_SECRET=ضع_قيمة_قوية_طويلة_هنا
REFRESH_TOKEN_SECRET=ضع_قيمة_قوية_طويلة_أخرى

# مفتاح Gemini (مطلوب للمحلل الدرامي)
GEMINI_API_KEY=ضع_مفتاح_جيميناي_هنا

# عنوان الواجهة الأمامية
FRONTEND_ORIGIN=http://localhost:4173
```

#### frontend/.env.production

```
VITE_API_BASE=http://localhost:4000/api
```

### بناء المشروع

```bash
npm run build
```

---

## ٤. التشغيل

### 🔥 بيئة التطوير

```bash
npm run dev
```

سيفتح المشروع على:
- Frontend: http://localhost:5173
- Backend: http://localhost:4000

### 🚀 بيئة الإنتاج

```bash
npm run start:prod
```

سيعمل على:
- الخادم المدمج: http://localhost:4000

---

## ٥. الاستخدام

### 📝 محرر السيناريو
1. اختر "المحرر" من الصفحة الرئيسية
2. ابدأ الكتابة مع التصحيح التلقائي
3. استخدم أدوات التحليل المدمجة

### 🎭 المحلل الدرامي
1. اختر "المحلل الدرامي" من الصفحة الرئيسية
2. ارفع ملفاتك (نصوص، PDF، صور)
3. اختر نمط التحليل المناسب:
   - **التحليل الفردي**: تحليل مخصص بخبير واحد
   - **المحادثة التفاعلية**: حوار مع خبير متخصص
   - **حوار السرب**: مناقشة جماعية بين عدة خبراء
4. احصل على تحليل مفصل وقابل للتصدير

---

## ٤. المعمارية

* **Frontend**: React + Vite → يتواصل مع API عبر `VITE_API_BASE`.
* **Backend**: Express + Node.js مع middleware للأمان (JWT, Helmet, Rate Limits).
* **Database**: PostgreSQL مع سياسات RLS.
* **Redis**: دعم اختياري لعمليات الطوابير (BullMQ) والكاش.
* **LLM Integration**: عبر واجهة `/api/llm/generate` باستخدام مفتاح Gemini.

---

## ٥. الأمان

* **JWT Authentication** لحماية جميع الـ routes الحساسة.
* **Row-Level Security (RLS)** في PostgreSQL مع وظيفة `current_user_id()`.
* **CORS** مضبوط على نطاقات موثوقة فقط.
* **Helmet** لتأمين الهيدر.
* **Rate Limiting** لمنع إساءة الاستخدام.
* **Logging** باستخدام Pino مع إخفاء الحقول الحساسة (Tokens, Passwords).
* **Secret Management** عبر ملفات env فقط (بدون أي secrets في الكود).

---

## ٦. الـ API

### Endpoints رئيسية

* **Auth**

  * `POST /api/auth/login`
  * `POST /api/auth/register`
  * `POST /api/auth/refresh`
* **LLM**

  * `POST /api/llm/generate` → يتطلب JWT
* **Exports**

  * `POST /api/export` → لتصدير الملفات
* **Health**

  * `GET /api/health` → يعرض حالة DB, Redis, uptime, memory

---

## ٧. المراقبة

* **Health Check** endpoint
* **PM2** لإدارة العمليات (ecosystem.config.js) مع auto-restart.
* **Structured Logging** عبر Pino بصيغة JSON.
* **Performance Monitoring**: أوقات استجابة < 100ms في المتوسط.

---

## ٨. النسخ الاحتياطي

* سكربت `scripts/backup_db.sh`
* إنشاء نسخة احتياطية يومية بوسم زمني.
* الاحتفاظ بآخر ٧ أيام فقط.
* تشغيل تلقائي عبر cron job.

---

## ٩. الاختبارات

* **Backend**: Jest
* **Frontend**: Vitest
* **CI/CD**: GitHub Actions (build + lint + test + audit + secret-scan).
* جميع الاختبارات تمر بنجاح محليًا وفي CI.

---

## ١٠. النشر

* **Build**

  ```bash
  npm run build --workspace=backend
  npm run build --workspace=frontend
  ```
* **تشغيل**

  ```bash
  NODE_ENV=production node backend/dist/server.js
  npm run preview --workspace=frontend
  ```
* Backend يعمل على المنفذ 4000
* Frontend يعمل على المنفذ 4173

---

## ١١. ملاحظات إضافية

* **Redis** معطّل افتراضيًا (`REDIS_ENABLED=false`).
* يمكن تشغيله لاحقًا لدعم BullMQ أو caching.
* يدعم أدوات مثل Puppeteer, pdf.js-dist, Tesseract OCR.
* توثيق كامل متاح في README\_DEPLOY.md المدموج هنا.

---

\[اكتملت المهمة بنجاح.]

---

تحب أطلعلك النسخة دي كملف جديد باسم **PROJECT\_FULL\_DOCUMENTATION.md** علشان تستخدمها مباشرة مع فريقك؟
